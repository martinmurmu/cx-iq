
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>PSA Mockup</title>

    <link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print">
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->

    <style type="text/css">

        body { margin:20px 0; }

        .centered {margin: 0 auto;}
        
        .bold {color: #000000; font-weight: bold;}
        .small {font-size: 80%;}
        .regular {color: #000000; font-weight: normal; }
        .positive {color: #008811; font-weight: bold;}
        .negative {color: #BB0000; font-weight: bold;}
        .review_text {line-height: 1; font-size: 90%; font-family: "Lucida Grande","Trebuchet MS",Verdana,Arial,Tahoma,sans-serif;}

        .review_title {font-weight: bold; color: #000000; line-height: 30px;}
        .review_author {font-style: italic; font-family: arial; color: #000000;}
        .review_date {color: #000000; font-size: 80%;}
        .review_source {line-height: 30px; font-size: 80%;}

        ul.review_attributes {
            list-style: none;
            margin-left: 0;
            padding-left: 1em;
            text-indent: -1em;
        }

    </style>
<!--
    <script type="text/javascript" src="js/gviz-api.js"></script>
-->
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript" src="js/jquery142.js"></script>
    <link rel="stylesheet" href="css/jquery.tooltip.css" />
    <script src="js/jquery.bgiframe.js" type="text/javascript"></script>
    <script src="js/jquery.dimensions.js" type="text/javascript"></script>
    <script src="js/jquery.tooltip.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/sprintf.js"></script>
    <script type="text/javascript">
//        google.load("jquery", "1.4.2");

        google.load('visualization', '1', {packages: ['table']});

        var psaData = [
            {'attrName': 'Car', 'attrScore': 1.41, 'posReviews': 73, 'negReviews': 3},
            {'attrName': 'Reliability', 'attrScore': 1.03, 'posReviews': 52, 'negReviews': 14},
            {'attrName': 'Usability', 'attrScore': 1.50, 'posReviews': 32, 'negReviews': 0},
            {'attrName': 'Price', 'attrScore': 0.23, 'posReviews': 24, 'negReviews': 2},
            {'attrName': 'General', 'attrScore': 1.34, 'posReviews': 13, 'negReviews': 5},
            {'attrName': 'Design', 'attrScore': 0.42, 'posReviews': 6, 'negReviews': 0},
            {'attrName': 'Other', 'attrScore': 1.25, 'posReviews': 18, 'negReviews': 3}
        ];

        var reviewsData = [
            {'score': 1.90, 'date': 'July 28, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Car', 'Reliability'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive" title="Tooltip !" id="for_tooltip">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.27, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Reliability', 'Usability'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.13, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Usability', 'Price'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.73, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Price', 'General'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.82, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['General', 'Design'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.44, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Design', 'Other'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.86, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Other', 'General', 'Price'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.01, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Reliability', 'Car'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.99, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Design', 'Price'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.38, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Reliability', 'Car'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.17, 'date': 'July 29, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Reliability', 'Car'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 1.25, 'date': 'June 16, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Price', 'Car'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.62, 'date': 'July 30, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Car', 'Usability'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">RELIABIITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'},
            {'score': 0.87, 'date': 'September 2, 2009', 'author': 'sadieapple from Oshkosh, wi',
                'source': 'http://www.kbb.com/new-cars/hyundai/sonata/2010/consumer-reviews?p=44',
                'attributes': ['Usability', 'Design'], 'title': 'I love my Sonata',
                'html': '<div class="review_text"><span class="regular">USABILITY REVIEW When I was looking for a new car a few years ago I drove a few different Toyotas, Kias and Hyundais. I was drawn to the Sonata initially for the great </span><span class="positive">pricing</span><span class="regular">. After driving other makes and models the Sonata was far more comfortable [usability::comfortable] and the engine was so much quieter then the others. My father has a older model Sonata and the improvements from his model [other_attributes::model] year to 2006 are awesome. Ive only had some minor paint issues [reliability::has * issues] and it has a few issues in the dead of winter, but other then that I would (and do) recommend the Sonata to anyone who is looking for a nice car at a great price. How long have you owned this vehicle?: 2 to 3 yrs </span></div>'}
        ];

        var productDetails = {'name': 'Hyundai', 'numReviews': 104, 'posReviews': 55, 'negReviews': 49, 'csi': 1.69};

        function getReviewHtml(dataItem)
        {
            var reviewHtml = '';

            reviewHtml += '<span class="review_title">' + dataItem.title + '</span><br/>';
            reviewHtml += '<span class="review_author">' + 'by ' + dataItem.author + '</span><br/>';
            reviewHtml += '<span class="review_date">' + dataItem.date + '</span><br/>';
            reviewHtml += '<span class="review_source"><a href="' + dataItem.source + '" target="_blank">Review source</a></span><br/>';

            reviewHtml += dataItem.html;

            return reviewHtml;
        }

        function getAttributesHtml(attributes)
        {
            var attrsHtml = '<ul class="review_attributes">';
            $.each(attributes, function(i, attr) {
                attrsHtml += sprintf('<li>&#187; %s</li>', attr);
            });
            attrsHtml += '</ul>';

            return attrsHtml;
        }

        function renderAttributesTable()
        {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Feature');
            data.addColumn('number', 'Score');
            data.addRows(psaData.length);

            var defFormat = {'style': 'color: blue; text-decoration: underline; cursor: pointer;'};

            for (var i = 0; i < psaData.length; i++)
            {
                data.setCell(i, 0, psaData[i].attrName, undefined, defFormat);
                data.setCell(i, 1, psaData[i].attrScore);
            }

            var table = new google.visualization.Table(document.getElementById('visualization'));

            var formatter = new google.visualization.TableBarFormat({width: 220, base: 1, drawZeroLine: true, min: 0, max: 2, colorPositive: 'green', colorNegative: 'red'});
            formatter.format(data, 1); // Apply formatter to second column

            table.draw(data, {allowHtml: true, showRowNumber: false, width: '100px'});

            google.visualization.events.addListener(table, 'select', function() {
                var selection = table.getSelection();

                if (0 == selection.length)
                {
                    return;
                }
                var psaItem = psaData[selection[0].row]; // allow to select only 1 row

                table.setSelection(null);

                $('#specific_reviews').html(sprintf('for feature <span class="bold">%s</span><span class="small"> <a href="#" onclick="renderProductDetails(); renderReviewsTable(null, 0); return false;">(all features)<a></span>', psaItem.attrName));

                renderReviewsDetails(psaItem, psaItem.attrName);
                renderReviewsTable(psaItem.attrName, 0);

            });

        }

        function renderReviewsDetails(item, attribute)
        {
            $('#details').html(
                    sprintf('<p>Display <a href="#" onclick="renderReviewsTable(\'%s\', 0); return false;">all reviews (%d)</a> | only <a href="#" onclick="renderReviewsTable(\'%s\', 1); return false;">positive reviews (%d)</a> | only <a href="#" onclick="renderReviewsTable(\'%s\', -1); return false;">negative reviews (%d)</a></p>',
                            attribute,
                            (+item.negReviews + item.posReviews),
                            attribute,
                            item.posReviews,
                            attribute,
                            item.negReviews)
                    );
        }

        // sign:
        //      -1: negative reviews
        //      0: all reviews
        //      1: positive reviews
        function renderReviewsTable(attribute, sign)
        {
            var reviewsTableData = new google.visualization.DataTable();
            reviewsTableData.addColumn('number', 'Overall Review Score');
            reviewsTableData.addColumn('string', 'Review Attributes');
            reviewsTableData.addColumn('string', 'Review Details');

            var filteredReviews = [];

            $.each(reviewsData, function(i, review) {
                if (attribute == null || attribute == '0' || $.inArray(attribute, review.attributes) > -1)
                {
                    if (sign == 0)
                    {
                        filteredReviews.push(review);
                    }
                    else if (sign > 0 && review.score >= 1.0)
                    {
                        filteredReviews.push(review);
                    }
                    else if (sign < 0 && review.score <= 1.0)
                    {
                        filteredReviews.push(review);
                    }
                }
            });

            reviewsTableData.addRows(filteredReviews.length);

            $.each(filteredReviews, function(i, review) {
                reviewsTableData.setCell(i, 0, review.score);
                reviewsTableData.setCell(i, 1, getAttributesHtml(review.attributes));
                reviewsTableData.setCell(i, 2, getReviewHtml(review));
            });

            var reviewsTable = new google.visualization.Table(document.getElementById('reviews'));

            var formatter = new google.visualization.TableBarFormat({width: 70, base: 1, drawZeroLine: true, min: 0, max: 2, colorPositive: 'green', colorNegative: 'red'});
            formatter.format(reviewsTableData, 0); // Apply formatter to second column

            reviewsTable.draw(reviewsTableData, {allowHtml: true, showRowNumber: false});

            $("#for_tooltip").tooltip({
   bodyHandler: function() {
     return "override !";
   }
});


        }

        function renderProductDetails()
        {
            $('#product_details').html(
                    sprintf('<h2>%s</h2>', productDetails.name) +
                    '<ul>' +
                    sprintf('<li>Number of reviews: %d</li>', productDetails.numReviews) +
                    sprintf('<li>Customer satisfaction index: %f</li>', productDetails.csi) +
                    '</ul>'
                    );
            $('#specific_reviews').html("for all features");            
            renderReviewsDetails(productDetails, 0);
        }


        function drawVisualization()
        {
            renderProductDetails();
            renderAttributesTable();
            renderReviewsTable(null, 0);
        }

        google.setOnLoadCallback(drawVisualization);
        
    </script>
</head>
<body>
    <div class="container">
        <div class="span-24 last">
		    <h1>Product Satisfaction Analysis</h1>
            <hr/>
	    </div>

        <div class="span-9 prepend-3">
                <img src="images/sonata.jpg" alt="Hyundai Sonata" width="205" height="131" />
        </div>
        <div class="span-12 last">
            <div id="product_details"></div>
        </div>

        <hr/>


        <div class="span-24 last">
            <h3>Product features</h3>
        </div>

        <div class="span-24 last">
            <div id="visualization" class="centered" style="width: 600px; height: 300px;"></div>
        </div>

        <div class="span-24 last">
            <h3>
                Detailed product reviews
                <div id="specific_reviews" style="display: inline;"></div>
            </h3>
        </div>

        <div class="span-24 last">
            <div id="details">
            </div>
        </div>

        <div class="span-24 last">
            <div id="reviews" style="width: 950px; height: 500px;">
        </div>

        </div>

    </div>
</body>
</html>
​